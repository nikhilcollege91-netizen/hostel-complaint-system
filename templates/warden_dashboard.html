{% extends "layout.html" %}
{% block title %}Warden Dashboard{% endblock %}
{% block content %}
<nav class="navbar">
    <div class="nav-container">
        <a class="nav-brand" href="{{ url_for('warden_dashboard') }}">
            Warden Dashboard
            {% if new_count > 0 %}
                <span class="notification-badge">{{ new_count }}</span>
            {% endif %}
        </a>
        <ul class="nav-links">
            <li><a href="{{ url_for('warden_analytics') }}">ðŸ“ˆ Analytics</a></li>
            <li><a href="{{ url_for('warden_profile') }}">ðŸ‘¤ Profile</a></li>
            <li><a href="{{ url_for('logout') }}">ðŸšª Logout</a></li>
        </ul>
    </div>
</nav>

<div class="container">
    <h2>All Student Complaints</h2>
    
    <div class="table-responsive">
        <table class="complaint-table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Proof</th>
                    <th>Status</th>
                    <th>Warden's Remark</th>
                </tr>
            </thead>
            <tbody>
                {% for complaint in complaints %}
                    <tr class="anim-row">
                        <td>{{ complaint.student_name }}</td>
                        <td>{{ complaint.title }}</td>
                        <td>{{ complaint.category }}</td>
                        <td><p class="description-cell">{{ complaint.description }}</p></td>
                        <td>
                            {% if complaint.proof_file %}
                                {% set ext = complaint.proof_file.split('.')[-1].lower() %}
                                
                                {% if ext in ['png', 'jpg', 'jpeg', 'gif'] %}
                                    <img src="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" alt="Proof Image" width="120" style="border-radius:6px; margin-top:5px;">
                                
                                {% elif ext in ['mp4', 'mov'] %}
                                    <video width="200" controls style="border-radius:6px; margin-top:5px;">
                                        <source src="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" type="video/{{ ext }}">
                                        Your browser does not support the video tag.
                                    </video>

                                {% elif ext in ['mp3', 'wav'] %}
                                    <audio controls style="width:200px; margin-top:5px;">
                                        <source src="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" type="audio/{{ ext }}">
                                        Your browser does not support the audio element.
                                    </audio>
                                
                                {% else %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" target="_blank">View</a>
                                {% endif %}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            <form action="{{ url_for('update_status', id=complaint.id) }}" method="POST">
                                <select name="status" onchange="this.form.submit()">
                                    <option value="Pending" {% if complaint.status == 'Pending' %}selected{% endif %}>ðŸŸ¡ Pending</option>
                                    <option value="In Progress" {% if complaint.status == 'In Progress' %}selected{% endif %}>ðŸŸ  In Progress</option>
                                    <option value="Resolved" {% if complaint.status == 'Resolved' %}selected{% endif %}>ðŸŸ¢ Resolved</option>
                                </select>
                            </form>
                        </td>
                        <td>
                            <form action="{{ url_for('add_remark', id=complaint.id) }}" method="POST" class="remark-form">
                                <textarea name="remark" rows="2" placeholder="Add a remark...">{{ complaint.remark or '' }}</textarea>
                                <button type="submit" class="btn btn-secondary btn-small">Save</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
