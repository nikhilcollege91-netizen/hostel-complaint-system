{% extends "layout.html" %}
{% block title %}Warden Dashboard{% endblock %}
{% block content %}
<nav class="navbar">
    <div class="nav-container">
        <a class="nav-brand" href="{{ url_for('warden_dashboard') }}">
            Warden Dashboard
            {% if new_count > 0 %}
                <span class="notification-badge">{{ new_count }}</span>
            {% endif %}
        </a>
        <ul class="nav-links">
            <li><a href="{{ url_for('warden_analytics') }}">ðŸ“ˆ Analytics</a></li>
            <li><a href="{{ url_for('warden_profile') }}">ðŸ‘¤ Profile</a></li>
            <li><a href="{{ url_for('logout') }}">ðŸšª Logout</a></li>
        </ul>
    </div>
</nav>

<div class="container" style="max-width: 95%; margin: auto;">
    <h2 style="margin-bottom: 20px;">All Student Complaints</h2>
    
    <div style="overflow-x: auto;">
        <table class="complaint-table" style="width: 100%; border-collapse: collapse; border-radius: 10px; overflow: hidden;">
            <thead style="background-color: #f4f7fb;">
                <tr>
                    <th>Student</th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Proof</th>
                    <th>Status</th>
                    <th>Warden's Remark</th>
                </tr>
            </thead>
            <tbody>
                {% for complaint in complaints %}
                    <tr class="anim-row" style="background: white; border-bottom: 1px solid #eee;">
                        <td>{{ complaint.student_name }}</td>
                        <td>{{ complaint.title }}</td>
                        <td>{{ complaint.category }}</td>
                        <td style="max-width: 200px; word-wrap: break-word;">{{ complaint.description }}</td>
                        
                        <td style="text-align: center;">
                            {% if complaint.proof_file %}
                                {% set ext = complaint.proof_file.split('.')[-1].lower() %}
                                
                                {% if ext in ['png', 'jpg', 'jpeg', 'gif'] %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" target="_blank">
                                        <img src="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" 
                                             alt="Proof Image" 
                                             width="120" 
                                             style="border-radius:6px; margin-top:5px; transition: transform 0.2s;"
                                             onmouseover="this.style.transform='scale(1.2)'"
                                             onmouseout="this.style.transform='scale(1)'">
                                    </a>
                                
                                {% elif ext in ['mp4', 'mov'] %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" target="_blank">ðŸŽ¥ View Video</a>

                                {% elif ext in ['mp3', 'wav'] %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" target="_blank">ðŸŽ§ Listen Audio</a>
                                
                                {% else %}
                                    <a href="{{ url_for('uploaded_file', filename=complaint.proof_file) }}" target="_blank">View</a>
                                {% endif %}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>

                        <td>
                            <form action="{{ url_for('update_status', id=complaint.id) }}" method="POST">
                                <select name="status" onchange="this.form.submit()" 
                                        style="padding:6px; border-radius:6px; border:1px solid #ccc;">
                                    <option value="Pending" {% if complaint.status == 'Pending' %}selected{% endif %}>ðŸŸ¡ Pending</option>
                                    <option value="In Progress" {% if complaint.status == 'In Progress' %}selected{% endif %}>ðŸŸ  In Progress</option>
                                    <option value="Resolved" {% if complaint.status == 'Resolved' %}selected{% endif %}>ðŸŸ¢ Resolved</option>
                                </select>
                            </form>
                        </td>

                        <td style="min-width: 200px;">
                            <form action="{{ url_for('add_remark', id=complaint.id) }}" method="POST" class="remark-form" style="display: flex; flex-direction: column; gap: 6px;">
                                <textarea name="remark" rows="2" placeholder="Add a remark..." 
                                          style="width: 100%; padding:6px; border-radius:6px; border:1px solid #ccc;">{{ complaint.remark or '' }}</textarea>
                                <button type="submit" class="btn btn-secondary btn-small" 
                                        style="align-self: flex-start; padding: 4px 10px; border-radius:6px;">Save</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .complaint-table th, .complaint-table td {
        padding: 10px 15px;
        text-align: left;
        vertical-align: top;
    }
    .complaint-table th {
        font-weight: 600;
        color: #333;
    }
    .complaint-table tr:hover {
        background-color: #f9fafc;
    }
</style>
{% endblock %}
